<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>CPU Usage</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-950 text-gray-100 font-sans flex flex-col h-screen">
  <!-- Header -->
  <header class="bg-gray-900 p-4 flex justify-between items-center">
    <h2 class="text-xl font-bold">CPU Usage</h2>
    <button onclick="location.href='index.html'" 
            class="bg-gray-700 hover:bg-gray-600 px-3 py-1 rounded-lg text-sm">← Back</button>
  </header>

  <!-- Chart Area -->
  <main class="flex-1">
    <canvas id="cpuChart" class="w-full h-full"></canvas>
  </main>

  <script>
    const wsUrl = `${location.protocol === "https:" ? "wss" : "ws"}://${location.host}/ws?role=dashboard`;
    const ws = new WebSocket(wsUrl);

    const cpuChart = new Chart(document.getElementById("cpuChart"), {
      type: "line",
      data: { labels: [], datasets: [{ label: "CPU %", data: [], borderColor: "#22c55e", backgroundColor: "#22c55e33", tension: 0.3 }] },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: { y: { beginAtZero: true, max: 100 } },
        plugins: { legend: { labels: { color: "#ccc" } } }
      }
    });

    ws.onmessage = (evt) => {
      const data = JSON.parse(evt.data);
      const ts = new Date().toLocaleTimeString();
      cpuChart.data.labels.push(ts);
      cpuChart.data.datasets[0].data.push(data.CPU.cpu_percent);
      if (cpuChart.data.labels.length > 50) {
        cpuChart.data.labels.shift();
        cpuChart.data.datasets[0].data.shift();
      }
      cpuChart.update();
    };
  </script>
</body>
</html>
