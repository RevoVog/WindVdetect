<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Realtime System Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-950 text-gray-100 font-sans">
  <!-- Header -->
  <header class="bg-gray-900 p-4 flex justify-between items-center shadow">
    <h2 class="text-2xl font-bold">⚡ Realtime System Dashboard</h2>
    <div id="status" class="text-sm text-gray-400">Connecting...</div>
  </header>

  <!-- Cards -->
  <main class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 p-6">
    
    <!-- CPU -->
    <div class="bg-gray-800 rounded-2xl p-4 shadow">
      <h3 class="text-lg font-semibold mb-2">CPU</h3>
      <div class="w-full bg-gray-700 rounded-full h-3 mb-2">
        <div id="cpu-bar" class="bg-green-500 h-3 rounded-full" style="width:0%"></div>
      </div>
      <p><span id="cpu-val">--</span>%</p>
      <button onclick="location.href='/cpu'"
              class="mt-2 text-xs bg-green-600 hover:bg-green-700 px-2 py-1 rounded-lg">
        See More →
      </button>
    </div>

    <!-- Memory -->
    <div class="bg-gray-800 rounded-2xl p-4 shadow">
      <h3 class="text-lg font-semibold mb-2">Memory</h3>
      <div class="w-full bg-gray-700 rounded-full h-3 mb-2">
        <div id="mem-bar" class="bg-blue-500 h-3 rounded-full" style="width:0%"></div>
      </div>
      <p><span id="mem-val">--</span>%</p>
      <button onclick="location.href='/mem'"
              class="mt-2 text-xs bg-blue-600 hover:bg-blue-700 px-2 py-1 rounded-lg">
        See More →
      </button>
    </div>

    <!-- Network -->
    <div class="bg-gray-800 rounded-2xl p-4 shadow">
      <h3 class="text-lg font-semibold mb-2">Network</h3>
      <div class="w-full bg-gray-700 rounded-full h-3 mb-2">
        <div id="net-bar" class="bg-yellow-500 h-3 rounded-full" style="width:0%"></div>
      </div>
      <p>Sent: <span id="net-sent">--</span> KB | Recv: <span id="net-recv">--</span> KB</p>
      <button onclick="location.href='/net'"
              class="mt-2 text-xs bg-yellow-600 hover:bg-yellow-700 px-2 py-1 rounded-lg">
        See More →
      </button>
    </div>
  </main>

  <!-- Full System Info -->
  <section class="p-6">
    <div class="bg-gray-800 rounded-2xl p-4 shadow">
      <h3 class="text-lg font-semibold mb-4">📊 System Information</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
        <p><b>Timestamp:</b> <span id="timestamp">--</span></p>
        <p><b>Host:</b> <span id="host">--</span></p>
        <p><b>Swap Memory:</b> <span id="swap">--</span></p>
        <p><b>Disk Partitions:</b> <span id="disk-part">--</span></p>
        <p><b>Disk Usage (C:):</b> <span id="disk-usage">--</span></p>
        <p><b>Disk IO:</b> <span id="disk-io">--</span></p>
        <p><b>Network Interfaces:</b> <span id="net-if">--</span></p>
        <p><b>Network Stats:</b> <span id="net-stats">--</span></p>
        <p><b>Battery:</b> <span id="battery">--</span></p>
        <p><b>Boot Time:</b> <span id="boot">--</span></p>
        <p><b>Users:</b> <span id="users">--</span></p>
        <p><b>Top CPU Processes:</b> <span id="top-cpu">--</span></p>
        <p><b>Top Memory Processes:</b> <span id="top-mem">--</span></p>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-gray-900 text-gray-400 text-xs text-center p-2">
    FastAPI • WebSocket powered
  </footer>

  <script>
    const wsUrl = `${location.protocol === "https:" ? "wss" : "ws"}://${location.host}/ws?role=dashboard`;
    const ws = new WebSocket(wsUrl);
    const statusEl = document.getElementById('status');

    ws.onopen = () => statusEl.textContent = "✅ Connected";
    ws.onclose = () => statusEl.textContent = "❌ Disconnected";
    ws.onerror = () => statusEl.textContent = "⚠️ Error";

    ws.onmessage = (evt) => {
      try {
        const data = JSON.parse(evt.data);

        // Progress bars
        document.getElementById("cpu-bar").style.width = data.CPU.cpu_percent + "%";
        document.getElementById("cpu-val").textContent = data.CPU.cpu_percent.toFixed(1);
        document.getElementById("mem-bar").style.width = data["Virtual Memory"].percent + "%";
        document.getElementById("mem-val").textContent = data["Virtual Memory"].percent;
        document.getElementById("net-bar").style.width = "100%"; // just a dummy fill
        document.getElementById("net-sent").textContent = (data["Network IO Counters"].bytes_sent/1024).toFixed(2);
        document.getElementById("net-recv").textContent = (data["Network IO Counters"].bytes_recv/1024).toFixed(2);

        // System info
        document.getElementById("timestamp").textContent = data.Timestamp;
        document.getElementById("host").textContent = data.Host;
        document.getElementById("swap").textContent = JSON.stringify(data["Swap Memory"]);
        document.getElementById("disk-part").textContent = JSON.stringify(data["Disk Partitions"]);
        document.getElementById("disk-usage").textContent = JSON.stringify(data["Disk Usage (C:)"]);
        document.getElementById("disk-io").textContent = JSON.stringify(data["Disk IO Counters"]);
        document.getElementById("net-if").textContent = JSON.stringify(data["Network Interfaces"]);
        document.getElementById("net-stats").textContent = JSON.stringify(data["Network Stats"]);
        document.getElementById("battery").textContent = JSON.stringify(data["Battery"]);
        document.getElementById("boot").textContent = data["Boot Time"];
        document.getElementById("users").textContent = JSON.stringify(data.Users);
        document.getElementById("top-cpu").textContent = JSON.stringify(data["Top CPU Processes"]);
        document.getElementById("top-mem").textContent = JSON.stringify(data["Top Memory Processes"]);
      } catch(e) { console.error(e); }
    };
  </script>
</body>
</html>
